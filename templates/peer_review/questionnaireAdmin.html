{% extends "peer_review/baseAdmin.html" %}
{% load staticfiles %}

{% block extrahead %}
	<script src="{% static "peer_review/js/tinymce/tinymce.min.js" %}"></script>
	<title>Questionnaire Admin</title>
{% endblock %}

{% block context %}
	<div class = "container">
		{% if messages %}
		    {% for message in messages %}
		    <div class = "alert alert-{{ message.tags }}"><strong>{{ message }}</strong></div>
		    {% endfor %}
		{% endif %}
		<div class = "panel panel-default">
			<div class="panel-heading">
				<h4 class="panel-title">Header</h4>
			</div>
			<div class="panel-body">
				<form onsubmit="return save()" id = "form-save" method="POST" action="/questionnaireAdmin/save">
					<label for="title">Title</label>
					<input type="text" name="title" class="form-control" id="title" placeholder="Enter title" value="{#{question.questionLabel}#}" required>
					<br/>
					<label for="intro">Introduction</label>
	                <input id="intro" class = "form-control" value="" name="intro">
	            </form>
			</div>
		</div>
		<div class = "panel panel-default">
			<div class="panel-heading">
				<h4 class="panel-title">Chose Questions</h4>
			</div>
			<div class="panel-body">
				 <div class="row">
                    <div class="col-md-6">
                    	<small class="text-muted">Click the <span class="glyphicon glyphicon glyphicon-plus-sign text-primary"></span> icon to add questions to the questionnaire.</small>
                        <table class='table moveable' id='question-table'>
                            <thead>
	                            <tr>
	                                <th>Question</th>
	                                <th>Question Type</th>
	                                <th>Grouping</th>
	                                <th></th>
	                            </tr>
                            </thead>
                            <tbody>
                            {% for question in questions %}
                                <tr id="{{ question.pk }}">
                                    <td class="question-label">{{ question.questionLabel }}</td>
                                    <td class="question-type">{{ question.questionType.name }}</td>
                                    <td class="question-grouping">{{ question.questionGrouping.grouping }}</td>
                                    <td>
                                    	<span onclick="addQuestion(this)" class="glyphicon glyphicon glyphicon-plus-sign text-primary pull-right"  style="cursor:pointer"></span>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                    	<small class="text-muted">Click the <span class="glyphicon glyphicon glyphicon-minus-sign text-primary"></span> icon to remove questions from the questionnaire.</small>
                        <table id="question-list" class="table moveable">
                        	<thead>
	                        	<tr>
	                        		<th></th>
	                                <th>Question</th>
	                                <th>Question Type</th>
	                                <th>Grouping</th>
	                        		<th></th>
	                            </tr>
                        	</thead>
                        </table>
                    </div>
                </div>
			</div>
		</div>
		<div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseOne">
                        <h4 class="panel-title">
                            Maintain Questionnaires <b class="caret"></b>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse">
                        <div class="panel-body">
                            <input type="text" class="form-control" id="question-search" placeholder="Start typing to search">
                        	<small class = "text-muted">Click the <span class="glyphicon glyphicon glyphicon-pencil text-primary"></span> icon to edit questionnaires, and the <span class="glyphicon glyphicon glyphicon-remove-circle text-primary"></span> icon to remove questionnaires.</small>
                        </div>
                        <table id = "questionnaire-list" class="table">
                        <thead>
                        	<tr>
                        		<th>Title</th>
                        		<th>Publish Date</th>
                        	</tr>
                        </thead>
                        <tbody>
                        	{# for-loop to load in questionnaires goes here #}
						</tbody>
                        </table> 
                        <form id = "form-delete" action = "/questionAdmin/delete" method="POST">
							{% csrf_token %}
							<input type="hidden" name = "questionnaire-pk" id = "questionnaire-pk">
						</form>   
                    </div>
                </div>
        </div>
	</div>

	<script>
		$(document).ready(function() {
			tinymce.init({ selector:'#intro',
            statusbar: false, 
            menubar: '',
            plugins: "emoticons",
            toolbar: 'undo redo bold italiclignleft aligncenter alignright bullist numlist outdent indent styleselect fontsizeselect emoticons a', });
		})

		function moveRow(el) {
			var row = $(el).closest('tr');
	        if ($(el).hasClass('glyphicon-arrow-up'))
	            row.prev().before(row);
	        else if ($(el).hasClass('glyphicon-arrow-down'))
	            row.next().after(row);
		}

		function addQuestion(el) {
			if ($(el).hasClass('text-primary')) {				
				var row = $(el).closest('tr'); 
				var tr = $('<tr></tr>');
				tr.append('<td><span onclick="moveRow(this)" class="glyphicon glyphicon glyphicon-arrow-up text-primary pull-left"  style="cursor:pointer"></span><span onclick="moveRow(this)" class="glyphicon glyphicon glyphicon-arrow-down text-primary pull-left"  style="cursor:pointer"></span></td>');
				tr.append('<td class="question-label">'+row.find('.question-label').html()+'</td>');
				tr.append('<td>'+row.find('.question-type').html()+'</td>');
				tr.append('<td>'+row.find('.question-grouping').html()+'</td>');
				tr.append('<td><span onclick="removeQuestion(this)" class="glyphicon glyphicon glyphicon-minus-sign text-primary pull-right"  style="cursor:pointer"></span></td>');
				$('#question-list').append(tr);
				$(el).removeClass('text-primary').addClass('text-muted');
			}
		}

		function removeQuestion(el) {
			$('#question-table > tbody > tr:contains("'+$(el).closest('tr').find('.question-label').html()+'")').find('span.glyphicon-plus-sign').addClass('text-primary').removeClass('text-muted');
			$(el).closest('tr').remove();
		}
	</script>
{% endblock %}